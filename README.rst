Introduction
============

This recipe adds additional ``filestorage`` and ``zodb_db`` stanzas to the ``zope.conf``
and ``zeo.conf`` files generated by the ``plone.recipe.zope2instance`` and
``plone.recipe.[zope2]zeoserver`` recipes.  It also creates the directories in which
the extra filestorage data files will be created.  This makes it easy to add
additional filestorages and mountpoints to a Zope 2 instance.


Supported options
=================

parts
    A list of filestorage sub-parts to be generated, one per line.  (This is
    different from buildout parts.)
zeo
    The name of a ``plone.recipe.zope2zeoserver`` or ``plone.recipe.zeoserver`` part to
    which we want to add the extra filestorage.  Defaults to the first such part
    in the buildout, if any.
zopes
    A list of names of ``plone.recipe.zope2instance`` parts to which we want to add
    the extra filestorage.  Defaults to all ``plone.recipe.zope2instance`` parts
    connected to the associated ``zeoserver`` part, if any, or all
    ``plone.recipe.zope2instance`` parts, if no ZEO is found.

The following options affect the generated ``zope.conf`` and ``zeo.conf``.  Each may be
specified for all filestorage subparts in the ``collective.recipe.filestorage``
buildout part, or for one particular filestorage subpart by placing the option
in a new buildout part called ``filestorage_subpart``, where *subpart* is the name
of the subpart listed in the ``parts`` option of this recipe.  The name of the
subpart may be interpolated by using ``%(fs_part_name)s`` in the option.

location
    The location of the ``Data.fs`` file, relative to the buildout root directory.
    Defaults to ``var/filestorage/%(fs_part_name)s/Data.fs``
zodb-name
    The name of the ZODB.  Defaults to ``%(fs_part_name)s``.
zodb-cache-size
    Set the ZODB cache size, i.e. the number of objects which the ZODB cache
    will try to hold.  Inherits from the associated Zope part.  Defaults to
    5000.
zodb-mountpoint
    Set the path to the mountpoint.  Defaults to ``/%(fs_part_name)s``.
    If the object is being mounted at a different path than its location
    in the source database, two paths may be provided using the
    ``virtualpath:realpath`` syntax. For example, when mounting ``/source/bar``
    from ``source.fs`` at ``/foo/bar`` in ``target.fs``:
    ``/foo/bar:/%(fs_part_name)s/bar``. **Note**: the name of the mount point
    and the mounted object must be the same, i.e. ``/foo:/bar`` will fail.
zodb-container-class
    Set the class of the object being mounted.  Defaults to not being set.
zeo-address
    Set the port of the associated ZEO server.  Inherits from the associated
    Zope and ZEO parts.  Defaults to 8100.
zeo-client-cache-size
    Set the size of the ZEO client cache. Inherits from the associated Zope
    part.  Defaults to '30MB'.
zeo-storage
    Set the id of the ZEO storage. Defaults to ``%(fs_part_name)s``.
zeo-client-name
    Set the name of the ZEO client. Defaults to ``%(fs_part_name)s_zeostorage``.
zeo-client-client
    Set the persistent cache name that is used to construct the cache
    filenames. Persistent cache files are disabled by default.
blob-storage
    Set the directory to be used to store blobs for a standalone Zope instance
    or a ZEO server. Optional. Required if you're going to store blobs, though.
    Recommended value: ``var/blobstorage-%(fs_part_name)s``
zeo-blob-storage
    Set the directory to be used to store blobs for a ZEO client. Defaults to
    using the same value as ``blob-storage``.
zeo-shared-blob-dir
    Boolean that should be 'on' if the blob dir is being shared by the ZEO
    server and client. Defaults to 'on'.


Running the tests
=================

The github checkout of ``collective.recipe.filestorage`` includes a buildout
which installs a script for running the tests.

Just run::

    python bootstrap.py
    bin/buildout
    bin/test

Known issue: The tests run buildout in a separate process, so it's currently
impossible to put a ``pdb`` breakpoint in the recipe and debug during the test.
If you need to do this, set up another buildout which uses
``collective.recipe.filestorage``
as a development egg.


Reporting bugs or asking questions
==================================

Use the github tracker:
https://github.com/collective/collective.recipe.filestorage/issues

Old bugs are at Launchpad:
https://bugs.launchpad.net/collective.buildout/
